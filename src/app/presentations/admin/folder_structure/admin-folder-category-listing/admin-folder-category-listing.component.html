<div class="management-container">
    <!-- Header Section -->
    <div class="management-header">
        <div class="flex align-items-center justify-content-between mb-4">
            <div>
                <h2 class="management-title">File Location Management</h2>
                <p class="management-subtitle">
                    Manage file location categories and their associated file
                    locations
                </p>
            </div>
            <div class="flex gap-2">
                <p-button
                    icon="pi pi-refresh"
                    [text]="true"
                    severity="secondary"
                    pTooltip="Refresh Data"
                    (click)="refresh()"
                >
                </p-button>
                <p-button
                    icon="pi pi-plus"
                    label="Add Category"
                    (click)="addCategory()"
                >
                </p-button>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-content-center p-6">
        <div class="flex flex-column align-items-center gap-3">
            <i
                class="pi pi-spin pi-spinner text-primary"
                style="font-size: 2rem"
            ></i>
            <span class="text-color-secondary"
                >Loading file location data...</span
            >
        </div>
    </div>

    <!-- Categories with nested File Locations -->
    <div *ngIf="!loading && categories.length > 0" class="categories-container">
        <div *ngFor="let category of categories" class="category-card mb-4">
            <p-card>
                <ng-template pTemplate="header">
                    <div
                        class="flex align-items-center justify-content-between p-3 pb-0"
                    >
                        <div class="flex align-items-center gap-3">
                            <i class="pi pi-folder text-primary text-2xl"></i>
                            <div>
                                <h3 class="category-name m-0">
                                    {{ category.name }}
                                </h3>
                                <p
                                    class="category-meta text-sm text-color-secondary m-0 mt-1"
                                >
                                    {{
                                        getFileLocationsForCategory(category)
                                            .length
                                    }}
                                    file locations
                                </p>
                            </div>
                        </div>
                        <div class="flex align-items-center gap-2">
                            <p-button
                                icon="pi pi-plus"
                                label="Add Location"
                                size="small"
                                severity="success"
                                (click)="addFileLocation(category)"
                            >
                            </p-button>
                            <p-button
                                icon="pi pi-pencil"
                                size="small"
                                [text]="true"
                                pTooltip="Edit Category"
                                (click)="editCategory(category)"
                            >
                            </p-button>
                        </div>
                    </div>
                </ng-template>

                <ng-template pTemplate="content">
                    <!-- File Locations Grid -->
                    <div class="file-locations-grid">
                        <div
                            *ngIf="
                                getFileLocationsForCategory(category).length ===
                                0
                            "
                            class="empty-locations text-center p-4"
                        >
                            <i
                                class="pi pi-map-marker text-4xl text-color-secondary mb-2"
                            ></i>
                            <p class="text-color-secondary m-0">
                                No file locations in this category
                            </p>
                            <p-button
                                label="Add First Location"
                                icon="pi pi-plus"
                                size="small"
                                class="mt-2"
                                (click)="addFileLocation(category)"
                            >
                            </p-button>
                        </div>

                        <div
                            *ngIf="
                                getFileLocationsForCategory(category).length > 0
                            "
                            class="grid"
                        >
                            <div
                                *ngFor="
                                    let location of getFileLocationsForCategory(
                                        category
                                    )
                                "
                                class="col-12 md:col-6 lg:col-4"
                            >
                                <div
                                    class="file-location-item p-3 border-1 surface-border border-round hover:surface-hover transition-colors transition-duration-150"
                                >
                                    <div
                                        class="flex align-items-start justify-content-between"
                                    >
                                        <div class="flex-1">
                                            <div
                                                class="flex align-items-center gap-2 mb-2"
                                            >
                                                <i
                                                    class="pi pi-map-marker text-primary"
                                                ></i>
                                                <span class="font-semibold">{{
                                                    location.name
                                                }}</span>
                                            </div>

                                            <div
                                                class="flex align-items-center gap-2 mb-2"
                                                *ngIf="location.description"
                                            >
                                                <span
                                                    class="text-sm text-color-secondary"
                                                    >{{
                                                        location.description
                                                    }}</span
                                                >
                                            </div>

                                            <div
                                                class="flex align-items-center gap-2"
                                            >
                                                <p-tag
                                                    value="Active"
                                                    severity="success"
                                                    [rounded]="true"
                                                >
                                                </p-tag>
                                            </div>
                                        </div>

                                        <div
                                            class="flex align-items-center gap-1"
                                        >
                                            <p-button
                                                icon="pi pi-pencil"
                                                size="small"
                                                [text]="true"
                                                pTooltip="Edit File Location"
                                                (click)="
                                                    editFileLocation(location)
                                                "
                                            >
                                            </p-button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-card>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && categories.length === 0" class="text-center p-6">
        <div class="empty-state">
            <i class="pi pi-folder text-6xl text-color-secondary mb-4"></i>
            <h3 class="text-color-secondary mb-3">No Categories Found</h3>
            <p class="text-color-secondary mb-4 line-height-3">
                Create your first file location category to organize your file
                locations. Categories help group related file locations together
                for better organization.
            </p>
            <p-button
                label="Create First Category"
                icon="pi pi-plus"
                size="large"
                (click)="addCategory()"
            >
            </p-button>
        </div>
    </div>
</div>

<!-- Toast for notifications -->
<p-toast></p-toast>
